-------------------------------------- Define table------------------------------------BEGIN;DROP TABLE IF EXISTS ascendco.item;CREATE TABLE IF NOT EXISTS ascendco.item (    id                                uuid                 NOT NULL DEFAULT NULL PRIMARY KEY,    item_arch_id                      uuid                 NOT NULL DEFAULT NULL,    facility_specialty_id             uuid                 NOT NULL DEFAULT NULL,    item_uu_id_across_item_archs      uuid                 NOT NULL DEFAULT NULL,    inv_responsible_user_id           uuid                 NOT NULL DEFAULT NULL,    facility_department_id            uuid                 NOT NULL DEFAULT NULL,    specialty_id                      uuid                 NOT NULL DEFAULT NULL,    sup_id                            uuid                 NOT NULL DEFAULT NULL,    dr_people_id                      uuid                 NOT NULL DEFAULT NULL,    item_type_id                      uuid                 NOT NULL DEFAULT NULL,    item_master_link_id               uuid                 NOT NULL DEFAULT NULL,    facility_location_id              uuid                 NOT NULL DEFAULT NULL,    clinic_id                         uuid                 NOT NULL DEFAULT NULL,    hsys_tag_id                       uuid                 NOT NULL DEFAULT NULL,    name_copied_from_prod_id          uuid                 NOT NULL DEFAULT NULL,    created_dts                       timestamp            NOT NULL DEFAULT 'epoch',    updated_dts                       timestamp            NOT NULL DEFAULT 'epoch',    named_dts                         timestamp            NOT NULL DEFAULT 'epoch',    needs_sched_sync_as_of_dts        timestamp            NOT NULL DEFAULT 'epoch',    weight_lb                         double precision     NOT NULL DEFAULT NULL,    qty                               integer              NOT NULL DEFAULT 0,    flow                              integer              NOT NULL DEFAULT 0,    flow_long                         integer              NOT NULL DEFAULT 0,    max_processed_one_day             integer              NOT NULL DEFAULT 0,    par                               integer              NOT NULL DEFAULT 0,    assembly_difficulty               integer              NOT NULL DEFAULT 0,    num_inst                          integer              NOT NULL DEFAULT 0,    repair_every_x                    integer              NOT NULL DEFAULT 0,    their_qty                         integer              NOT NULL DEFAULT 0,    replace_every_x_cycles            integer              NOT NULL DEFAULT 0,    marked_for_deletion               boolean              NOT NULL DEFAULT false,    is_name_finalized                 boolean              NOT NULL DEFAULT false,    ignore_for_optimization           boolean              NOT NULL DEFAULT false,    name_needs_review                 boolean              NOT NULL DEFAULT false,    is_vendor_data                    boolean              NOT NULL DEFAULT false,    is_deactivated                    boolean              NOT NULL DEFAULT false,    is_name_copied_from_prod          boolean              NOT NULL DEFAULT false,    is_custom_sort                    boolean              NOT NULL DEFAULT false,    inv_has_implants                  boolean              NOT NULL DEFAULT false,    sync_to_other_software_systems    boolean              NOT NULL DEFAULT false,    has_implants                      boolean              NOT NULL DEFAULT false,    is_label_abbr                     boolean              NOT NULL DEFAULT false,    is_in_data_cleanse_scope          boolean              NOT NULL DEFAULT false,    hide_specialty_in_name            boolean              NOT NULL DEFAULT false,    hide_hsys_tag_in_name             boolean              NOT NULL DEFAULT false,    is_small_set                      boolean              NOT NULL DEFAULT false,    is_conflict_check                 boolean              NOT NULL DEFAULT false,    dont_print_count_sheet            boolean              NOT NULL DEFAULT false,    is_generic_pack                   boolean              NOT NULL DEFAULT false,    is_flexible_scope                 boolean              NOT NULL DEFAULT false,    is_robotic                        boolean              NOT NULL DEFAULT false,    is_imlink_locked                  boolean              NOT NULL DEFAULT false,    is_not_tracked_by_inv_no          boolean              NOT NULL DEFAULT false,    requires_leak_test                boolean              NOT NULL DEFAULT false,    is_assembly_critical              boolean              NOT NULL DEFAULT false,    their_name                        citext               NOT NULL DEFAULT NULL,    inv_status                        citext               NOT NULL DEFAULT NULL,    opt_status                        citext               NOT NULL DEFAULT NULL,    created_by                        citext               NOT NULL DEFAULT NULL,    updated_by                        citext               NOT NULL DEFAULT NULL,    old_names                         citext               NOT NULL DEFAULT NULL,    their_serial_no                   citext               NOT NULL DEFAULT NULL,    name_desc                         citext               NOT NULL DEFAULT NULL,    name_                             citext               NOT NULL DEFAULT NULL,    their_id                          citext               NOT NULL DEFAULT NULL,    decon_special_instructions        citext               NOT NULL DEFAULT NULL,    named_by                          citext               NOT NULL DEFAULT NULL,    needs_review_notes                citext               NOT NULL DEFAULT NULL,    vendor_tray_type                  citext               NOT NULL DEFAULT NULL,    sterilization_method              citext               NOT NULL DEFAULT NULL,    priority                          citext               NOT NULL DEFAULT NULL,    category                          citext               NOT NULL DEFAULT NULL,    packaging_type                    citext               NOT NULL DEFAULT NULL,    packaging_notes                   citext               NOT NULL DEFAULT NULL,    their_packaging_type              citext               NOT NULL DEFAULT NULL,    assembly_special_instructions     citext               NOT NULL DEFAULT NULL,    sterilize_special_instructions    citext               NOT NULL DEFAULT NULL,    label_name_abbr                   citext               NOT NULL DEFAULT NULL,    their_location                    citext               NOT NULL DEFAULT NULL,    count_sheet_status                citext               NOT NULL DEFAULT NULL,    requested_by                      citext               NOT NULL DEFAULT NULL,    rack_row_bin_note                 citext               NOT NULL DEFAULT NULL,    standardization_status            citext               NOT NULL DEFAULT NULL,    repair_every_x_type               citext               NOT NULL DEFAULT NULL,    their_base_barcode                citext               NOT NULL DEFAULT NULL,    their_key                         citext               NOT NULL DEFAULT NULL,    stuff                             jsonb                NOT NULL DEFAULT '{}'::jsonb);ALTER TABLE ascendco.item	OWNER TO user_change_structure;-------------------------------------- Build statistics------------------------------------/*The Postgres ANALYZE system function collects statistics about each table and column. These valuesare used by the query planner to help generate probabilistic cost estimates for various query plans.When the plans are based on misleading stats, you can have poor performance. Stats can be reconfiguredon a row-by-row basis, and some special extended statistics are supported too. Custom and extended statistics are typically added after we've been accumulating data for some time.See PgBuildStatistics_Extended in IB to declare new statistics objects. For more background, seehttps://ascendco.atlassian.net/wiki/spaces/SON/pages/1723695105/*/-------------------------------------- ANALYZE options-------------------------------------- Placholder and reminder for now. ANALYZE and AUTOVACUUM tunings are *core* Postgres DBA-- skills. But, for the minute, we're not running into trouble. I'm chipping away af figuring-- out when to tune, and how, and when not to tune. ‚Äî DPA-------------------------------------- Build indexes-------------------------------------- Note: Postgres automatically creates a UNIQUE B-tree for the PRIMARY KEY, simple or compound./* Indexing trade-offs are different in 4D and Postgres.It pays to be a bit conservative about adding indexes in Postgres, wait and see what you need.CREATE INDEX item_item_arch_id_ix_btree          ON ascendco.item       USING btree (item_arch_id);CREATE INDEX item_facility_specialty_id_ix_gin          ON ascendco.item       USING GIN (facility_specialty_id);CREATE INDEX item_inv_responsible_user_id_ix_gin          ON ascendco.item       USING GIN (inv_responsible_user_id);CREATE INDEX item_facility_department_id_ix_gin          ON ascendco.item       USING GIN (facility_department_id);CREATE INDEX item_specialty_id_ix_gin          ON ascendco.item       USING GIN (specialty_id);CREATE INDEX item_item_type_id_ix_gin          ON ascendco.item       USING GIN (item_type_id);CREATE INDEX item_item_master_link_id_ix_btree          ON ascendco.item       USING btree (item_master_link_id);CREATE INDEX item_facility_location_id_ix_btree          ON ascendco.item       USING btree (facility_location_id);CREATE INDEX item_clinic_id_ix_btree          ON ascendco.item       USING btree (clinic_id);CREATE INDEX item_hsys_tag_id_ix_gin          ON ascendco.item       USING GIN (hsys_tag_id);CREATE INDEX item_name_copied_from_prod_id_ix_gin          ON ascendco.item       USING GIN (name_copied_from_prod_id);CREATE INDEX item_created_dts_ix_btree          ON ascendco.item       USING btree (created_dts);CREATE INDEX item_needs_sched_sync_as_of_dts_ix_btree          ON ascendco.item       USING btree (needs_sched_sync_as_of_dts);CREATE INDEX item_repair_every_x_ix_gin          ON ascendco.item       USING GIN (repair_every_x);CREATE INDEX item_replace_every_x_cycles_ix_gin          ON ascendco.item       USING GIN (replace_every_x_cycles);CREATE INDEX item_marked_for_deletion_ix_gin          ON ascendco.item       USING GIN (marked_for_deletion extensions.bool_ops)       WHERE marked_for_deletion = true;CREATE INDEX item_is_name_finalized_ix_gin          ON ascendco.item       USING GIN (is_name_finalized);CREATE INDEX item_is_deactivated_ix_gin          ON ascendco.item       USING GIN (is_deactivated);CREATE INDEX item_is_name_copied_from_prod_ix_gin          ON ascendco.item       USING GIN (is_name_copied_from_prod);CREATE INDEX item_has_implants_ix_gin          ON ascendco.item       USING GIN (has_implants);CREATE INDEX item_is_in_data_cleanse_scope_ix_gin          ON ascendco.item       USING GIN (is_in_data_cleanse_scope);CREATE INDEX item_their_name_ix_btree          ON ascendco.item       USING btree (their_name);CREATE INDEX item_name_ix_btree          ON ascendco.item       USING btree (name_);CREATE INDEX item_their_id_ix_btree          ON ascendco.item       USING btree (their_id);CREATE INDEX item_vendor_tray_type_ix_gin          ON ascendco.item       USING GIN (vendor_tray_type);CREATE INDEX item_category_ix_gin          ON ascendco.item       USING GIN (category);CREATE INDEX item_count_sheet_status_ix_gin          ON ascendco.item       USING GIN (count_sheet_status);*/-------------------------------------- CLUSTER------------------------------------/*Code stub/reminder about CLUSTERing. Not a hard topic, but too big to write up here. Notes and links:https://ascendco.atlassian.net/wiki/spaces/SON/pages/356679683/ALTER TABLE ascendco.item    CLUSTER ON ***index name to cluster by here.***;*/-------------------------------------- Add triggers------------------------------------   CREATE TRIGGER trigger_item_after_delete            AFTER DELETE               ON ascendco.item      REFERENCING OLD TABLE AS deleted_rows          FOR EACH STATEMENTEXECUTE PROCEDURE ascendco.trigger_function_log_deletion_count();  CREATE TRIGGER trigger_item_before_truncate            BEFORE TRUNCATE               ON ascendco.item         FOR EACH STATEMENTEXECUTE PROCEDURE ascendco.trigger_function_log_truncation_count();-------------------------------------- Manual Permissions for now-------------------------------------- Standard permissions for utility/admin users:GRANT SELECT, INSERT, UPDATE, DELETE ON ascendco.item TO rds_super;GRANT SELECT, INSERT, UPDATE, DELETE ON ascendco.item TO user_cleanup;GRANT SELECT, INSERT, UPDATE, DELETE ON ascendco.item TO user_change_structure;GRANT SELECT ON ascendco.item TO user_reporting;-- Adjustable user permissions:GRANT SELECT ON ascendco.item TO user_iceberg;GRANT SELECT ON ascendco.item TO user_iceberg_remote;GRANT SELECT ON ascendco.item TO user_saws;GRANT SELECT ON ascendco.item TO user_sonar;GRANT SELECT, INSERT, UPDATE ON ascendco.item TO user_leviathan;COMMIT;