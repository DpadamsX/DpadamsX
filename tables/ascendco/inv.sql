-------------------------------------- Define table------------------------------------BEGIN;DROP TABLE IF EXISTS ascendco.inv;CREATE TABLE IF NOT EXISTS ascendco.inv (    id                             uuid          NOT NULL DEFAULT NULL PRIMARY KEY,    item_id                        uuid          NOT NULL DEFAULT NULL,    item_arch_id                   uuid          NOT NULL DEFAULT NULL,    facility_location_id           uuid          NOT NULL DEFAULT NULL,    standard_faclity_id            uuid          NOT NULL DEFAULT NULL,    store_at_facility_id           uuid          NOT NULL DEFAULT NULL,    created_dts                    timestamp     NOT NULL DEFAULT 'epoch',    updated_dts                    timestamp     NOT NULL DEFAULT 'epoch',    serial_no_as_of_dts            timestamp     NOT NULL DEFAULT 'epoch',    qty                            integer       NOT NULL DEFAULT 0,    flow                           integer       NOT NULL DEFAULT 0,    flow_long                      integer       NOT NULL DEFAULT 0,    par                            integer       NOT NULL DEFAULT 0,    last_seen_date                 date          NOT NULL DEFAULT NULL,    their_next_repair_date         date          NOT NULL DEFAULT NULL,    last_sterilized_date           date          NOT NULL DEFAULT NULL,    repair_last_repair_date        date          NOT NULL DEFAULT NULL,    marked_for_deletion            boolean       NOT NULL DEFAULT false,    is_found                       boolean       NOT NULL DEFAULT false,    is_go_live_perm_printed        boolean       NOT NULL DEFAULT false,    is_facility_loc_inherited      boolean       NOT NULL DEFAULT false,    is_contents_incomplete         boolean       NOT NULL DEFAULT false,    is_deactivated                 boolean       NOT NULL DEFAULT false,    needs_repair                   boolean       NOT NULL DEFAULT false,    is_searched_but_not_found      boolean       NOT NULL DEFAULT false,    is_wrong_loc                   boolean       NOT NULL DEFAULT false,    is_handwritten_label           boolean       NOT NULL DEFAULT false,    is_sleeping                    boolean       NOT NULL DEFAULT false,    category                       citext        NOT NULL DEFAULT NULL,    their_name                     citext        NOT NULL DEFAULT NULL,    their_id                       citext        NOT NULL DEFAULT NULL,    their_location                 citext        NOT NULL DEFAULT NULL,    created_by                     citext        NOT NULL DEFAULT NULL,    updated_by                     citext        NOT NULL DEFAULT NULL,    their_id_scrubbed              citext        NOT NULL DEFAULT NULL,    crossing_status                citext        NOT NULL DEFAULT NULL,    inv_no                         citext        NOT NULL DEFAULT NULL,    their_raw_name                 citext        NOT NULL DEFAULT NULL,    comments_                      citext        NOT NULL DEFAULT NULL,    their_bar_code                 citext        NOT NULL DEFAULT NULL,    loc_rack                       citext        NOT NULL DEFAULT NULL,    loc_row                        citext        NOT NULL DEFAULT NULL,    loc_bin                        citext        NOT NULL DEFAULT NULL,    loc_note                       citext        NOT NULL DEFAULT NULL,    serial_no                      citext        NOT NULL DEFAULT NULL,    data_cleanse_classification    citext        NOT NULL DEFAULT NULL,    repair_next_due                citext        NOT NULL DEFAULT NULL,    repair_last_repaired_by        citext        NOT NULL DEFAULT NULL,    msgs                           jsonb         NOT NULL DEFAULT '{}'::jsonb);ALTER TABLE ascendco.inv	OWNER TO user_change_structure;-------------------------------------- Build statistics------------------------------------/*The Postgres ANALYZE system function collects statistics about each table and column. These valuesare used by the query planner to help generate probabilistic cost estimates for various query plans.When the plans are based on misleading stats, you can have poor performance. Stats can be reconfiguredon a row-by-row basis, and some special extended statistics are supported too.Custom and extended statistics are typically added after we've been accumulating data for some time.See PgBuildStatistics_Extended in IB to declare new statistics objects. For more background, seehttps://ascendco.atlassian.net/wiki/spaces/SON/pages/1723695105/*/-------------------------------------- ANALYZE options-------------------------------------- Placholder and reminder for now. ANALYZE and AUTOVACUUM tunings are *core* Postgres DBA-- skills. But, for the minute, we're not running into trouble. I'm chipping away af figuring-- out when to tune, and how, and when not to tune. ‚Äî DPA-------------------------------------- Build indexes-------------------------------------- Note: Postgres automatically creates a UNIQUE B-tree for the PRIMARY KEY, simple or compound./* Indexing trade-offs are different in 4D and Postgres.It pays to be a bit conservative about adding indexes in Postgres, wait and see what you need.CREATE INDEX inv_item_id_ix_btree          ON ascendco.inv       USING btree (item_id);CREATE INDEX inv_item_arch_id_ix_btree          ON ascendco.inv       USING btree (item_arch_id);CREATE INDEX inv_facility_location_id_ix_gin          ON ascendco.inv       USING GIN (facility_location_id);CREATE INDEX inv_serial_no_as_of_dts_ix_btree          ON ascendco.inv       USING btree (serial_no_as_of_dts);CREATE INDEX inv_their_next_repair_date_ix_btree          ON ascendco.inv       USING btree (their_next_repair_date);CREATE INDEX inv_last_sterilized_date_ix_btree          ON ascendco.inv       USING btree (last_sterilized_date);CREATE INDEX inv_marked_for_deletion_ix_gin          ON ascendco.inv       USING GIN (marked_for_deletion extensions.bool_ops)       WHERE marked_for_deletion = true;CREATE INDEX inv_is_found_ix_gin          ON ascendco.inv       USING GIN (is_found);CREATE INDEX inv_is_deactivated_ix_gin          ON ascendco.inv       USING GIN (is_deactivated);CREATE INDEX inv_is_searched_but_not_found_ix_gin          ON ascendco.inv       USING GIN (is_searched_but_not_found);CREATE INDEX inv_their_bar_code_ix_btree          ON ascendco.inv       USING btree (their_bar_code);CREATE INDEX inv_serial_no_ix_btree          ON ascendco.inv       USING btree (serial_no);CREATE INDEX inv_data_cleanse_classification_ix_btree          ON ascendco.inv       USING btree (data_cleanse_classification);*/-------------------------------------- CLUSTER------------------------------------/*Code stub/reminder about CLUSTERing. Not a hard topic, but too big to write up here. Notes and links:https://ascendco.atlassian.net/wiki/spaces/SON/pages/356679683/ALTER TABLE ascendco.inv    CLUSTER ON ***index name to cluster by here.***;*/-------------------------------------- Add triggers------------------------------------   CREATE TRIGGER trigger_inv_after_delete            AFTER DELETE               ON ascendco.inv      REFERENCING OLD TABLE AS deleted_rows         FOR EACH STATEMENTEXECUTE PROCEDURE ascendco.trigger_function_log_deletion_count();  CREATE TRIGGER trigger_inv_before_truncate            BEFORE TRUNCATE               ON ascendco.inv         FOR EACH STATEMENTEXECUTE PROCEDURE ascendco.trigger_function_log_truncation_count();-------------------------------------- Manual Permissions for now-------------------------------------- Standard permissions for utility/admin users:GRANT SELECT, INSERT, UPDATE, DELETE ON ascendco.inv TO rds_super;GRANT SELECT, INSERT, UPDATE, DELETE ON ascendco.inv TO user_cleanup;GRANT SELECT, INSERT, UPDATE, DELETE ON ascendco.inv TO user_change_structure;GRANT SELECT ON ascendco.inv TO user_reporting;-- Adjustable user permissions:GRANT SELECT ON ascendco.inv TO user_iceberg;GRANT SELECT ON ascendco.inv TO user_iceberg_remote;GRANT SELECT ON ascendco.inv TO user_saws;GRANT SELECT ON ascendco.inv TO user_sonar;GRANT SELECT, INSERT, UPDATE ON ascendco.inv TO user_leviathan;COMMIT;