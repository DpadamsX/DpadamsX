------------------------------------------------------------------------------------- Checks for dba.views_using_field (table_name text, column_name text) function------------------------------------------------------------------------------------- Existence check:select * from test_case_setup('Function', 'dba', 'views_using_field (table_name text, column_name text)', '()', 'dba.views_using_field table_name text, column_name text existence check', 'select count(*) from pg_proc where pronamespace::regnamespace::text = ''dba''   and proname = ''views_using_field''   and pg_get_function_identity_arguments(oid) = ''table_name text, column_name text'';', '1', '', 'text', '{"comparator":"equals","column_order":"ignore","case_sensitivity":"blind","whitespace_cleaning":"all","normalize_line_endings":true}', 'Pass', '{user_change_structure}', FALSE, FALSE, '', '');-- Definition check:select * from test_case_setup('Function', 'dba', 'views_using_field (table_name text, column_name text)', '()', 'dba.views_using_field table_name text, column_name text definition check', 'select pg_get_functiondef(oid) from pg_proc where pronamespace::regnamespace::text = ''dba''   and proname = ''views_using_field''   and pg_get_function_identity_arguments(oid) = ''table_name text, column_name text'';', 'CREATE OR REPLACE FUNCTION dba.views_using_field(table_name text, column_name text) RETURNS TABLE(schema_name citext, view_name citext) LANGUAGE sqlAS $function$SELECT pg_namespace.nspname::citext   AS schema_name,       pg_class.oid::regclass::citext AS view_name FROM pg_attribute   -- columns for the table JOIN pg_depend   -- objects that depend on the column   ON pg_depend.refobjsubid = pg_attribute.attnum  AND pg_depend.refobjid = pg_attribute.attrelid JOIN pg_rewrite  -- rules depending on the column   ON pg_rewrite.oid = pg_depend.objid JOIN pg_class    -- views for the rules   ON pg_class.oid = pg_rewrite.ev_class JOIN pg_namespace -- I added this is to include the schema_name in the output. -- DPA   ON pg_class.relnamespace  = pg_namespace.oidWHERE pg_class.relkind = ''v''    -- only interested in views  -- dependency must be a rule depending on a relation  AND pg_depend.classid     = ''pg_rewrite''::regclass  AND pg_depend.refclassid  = ''pg_class''::regclass  AND pg_depend.deptype     = ''n''    -- normal dependency  AND pg_attribute.attrelid = table_name::regclass  AND pg_attribute.attname  = column_name;$function$', '', 'text', '{"comparator":"equals","column_order":"ignore","case_sensitivity":"blind","whitespace_cleaning":"all","normalize_line_endings":true}', 'Pass', '{user_change_structure}', FALSE, FALSE, '', '');