DROP VIEW IF EXISTS api.activity_domo;-- Query addapted from Will on Feb 11, 2021.CREATE VIEW api.activity_domo ASSELECT     activity.id                                                                     AS "id",     COALESCE (facility.name_, ''::citext)                                           AS "FacilityName",     COALESCE (hsys.name_, ''::citext)                                               AS "HsysName",     COALESCE (web_user.username, ''::citext)                                        AS "UserName",     COALESCE (facility_activities.name_, ''::citext)                                AS "ActivityName",     activity.facility_activities_id                                                 AS "ActivitiesID",     activity.other_desc                                                             AS "OtherActivityName",     activity.start_dts                                                              AS "StartTime_DTS",     activity.start_dts AT TIME ZONE facility.tz_name_pg                             AS "StartTime_Local_DTS",     activity.done_dts                                                               AS "DoneTime_DTS",     activity.duration_seconds                                                       AS "Duration_Seconds",     ROUND(activity.duration_seconds/60.,2)                                          AS "Duration_Mins",     ROUND(activity.duration_seconds/3600.,2)                                        AS "Duration_Hours",     scan_date.date_actual                                                           AS "ActivityTime_Date",     scan_date.day_of_week_usa                                                       AS "ActivityTime_DayOfWeek",     scan_date.day_name_abbreviated                                                  AS "ActivityTime_DayName",     scan_date.week_of_year_fiscal_name                                              AS "ActivityTime_FiscalWeek",   --  Week 24 2020     scan_date.week_of_year_fiscal                                                   AS "ActivityTime_FiscalWeekNo", --  2020-24     scan_date.month_actual                                                          AS "ActivityTime_MonthNo",     scan_date.month_actual_name_abbreviated                                         AS "ActivityTime_MonthName",     scan_date.month_fiscal                                                          AS "ActivityTime_FiscalMonthNo",     scan_date.month_fiscal_name_abbreviated                                         AS "ActivityTime_FiscalMonthName",     to_char(scan_date.year_actual, 'fm0000')                                        AS "ActivityTime_Year",     scan_date.year_actual                                                           AS "ActivityTime_YearNo",     scan_date.fiscal_year_abbr::int                                                 AS "ActivityTime_FiscalYearNo",     (date_part('hour'::text, activity.start_dts))::integer                          AS "ActivityTime_HourOfDay",     hour_bin_get_bin((date_part('hour'::text, activity.start_dts))::integer)        AS "ActivityTime_HourBin",     hour_bin_get_bin_label((date_part('hour'::text, activity.start_dts))::integer)  AS "ActivityTime_HourBinName"FROM activityLEFT JOIN facility              ON facility.id             =  activity.facility_idLEFT JOIN hsys                  ON hsys.id                 =  facility.hsys_idLEFT JOIN facility_activities   ON facility_activities.id  =  activity.facility_activities_idLEFT JOIN web_user              ON web_user.id             =  activity.web_user_idJOIN calendar_day_plus scan_date  ON (scan_date.calendar_id = facility.calendar_id AND scan_date.date_actual = date(activity.created_dts))WHERE      activity.marked_for_deletion = 'false';ALTER VIEW api.activity_domo    OWNER TO user_change_structure;-------------------------------------------------- Register view------------------------------------------------CALL view_register ('api','activity_domo','activity data for Domo.');