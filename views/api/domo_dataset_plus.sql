CREATE OR REPLACE VIEW api.domo_dataset_plus AS /* Create a CTE so that we can used the calculation easily in a case structure in the main select. */ WITH datasets AS 	(select	domo_dataset.id,		    domo_dataset.dataset_name,		    domo_dataset.columns_count,			domo_dataset.rows_count,		    domo_dataset.created_at_dts,		    domo_dataset.updated_at_dts,		    domo_dataset.late_threshold_minutes,		    domo_dataset.late_threshold_minutes > 0 AS monitor_this,		    round(extract(epoch from(age(now(),domo_dataset.updated_at_dts)))::numeric,0) AS minutes_since_update		FROM domo_dataset) SELECT id,		dataset_name,		columns_count,		rows_count,		created_at_dts,		updated_at_dts,		monitor_this,		late_threshold_minutes,		minutes_since_update,		minutes_since_update - late_threshold_minutes AS minutes_late,    	CASE			WHEN late_threshold_minutes < 1 THEN 'unmonitored'			WHEN late_threshold_minutes < minutes_since_update THEN 'late'			ELSE 'okay'		END AS dataset_status,		CASE			WHEN late_threshold_minutes < 1 THEN false			WHEN minutes_since_update - late_threshold_minutes > 0 THEN true			ELSE false		END AS is_late,		CASE			WHEN late_threshold_minutes < 1 THEN 0			WHEN minutes_since_update - late_threshold_minutes > 0 THEN 1			ELSE 0		END AS is_late_number  FROM datasets;ALTER VIEW api.domo_dataset_plus    OWNER TO user_change_structure;-------------------------------------------------- Register view------------------------------------------------CALL view_register ('api','domo_dataset_plus','Proof-of-concept for a Domo DataSet size and last update monitor.','RDS Domo DataSet Age');