CREATE OR REPLACE VIEW api.analytic_sterilizer_load_domo AS WITH expanded_data AS (         SELECT hsys.name_ AS "HsysName",            facility.name_ AS "FacilityName",            COALESCE(web_user.name_full, ''::citext) AS "UserName",            COALESCE(sterilizer.name_, ''::citext) AS "Sterilizer",            analytic_sterilizer_load.status AS "Status",            COALESCE(sterilize_method.name_, ''::citext) AS "Method",            COALESCE(sterilize_params.name_, ''::citext) AS "Params",            (analytic_sterilizer_load.is_iuss)::text AS "isIUSS",            analytic_sterilizer_load.trays_count AS "NumTrays",            analytic_sterilizer_load.packs_count AS "NumPacks",            analytic_sterilizer_load.instruments_count AS "NumInst",            analytic_sterilizer_load.status_building_dts AS "Built_UTC",            analytic_sterilizer_load.status_building_dts AS "BuiltDTS",            analytic_sterilizer_load.status_building_local_dts AS "Built_Local",            date(analytic_sterilizer_load.status_building_local_dts) AS "Built_Date",            (date_part('dow'::text, analytic_sterilizer_load.status_building_local_dts))::integer AS "Built_DayOfWeek",            to_char(analytic_sterilizer_load.status_building_local_dts, 'Day'::text) AS "Built_DayName",            (date_part('hour'::text, analytic_sterilizer_load.status_building_local_dts))::integer AS "Built_HourOfDay",            hour_bin_get_bin((date_part('hour'::text, analytic_sterilizer_load.status_building_local_dts))::integer) AS "Built_HourBin",            hour_bin_get_bin_label((date_part('hour'::text, analytic_sterilizer_load.status_building_local_dts))::integer) AS "Built_HourBinName",            analytic_sterilizer_load.status_done_dts AS "Done_UTC",            analytic_sterilizer_load.status_done_dts AS "DoneDTS",            analytic_sterilizer_load.status_done_local_dts AS "Done_Local",            date(analytic_sterilizer_load.status_done_local_dts) AS "Done_Date",            (date_part('dow'::text, analytic_sterilizer_load.status_done_local_dts))::integer AS "Done_DayOfWeek",            to_char(analytic_sterilizer_load.status_done_local_dts, 'Day'::text) AS "Done_DayName",            (date_part('hour'::text, analytic_sterilizer_load.status_done_local_dts))::integer AS "Done_HourOfDay",            hour_bin_get_bin((date_part('hour'::text, analytic_sterilizer_load.status_done_local_dts))::integer) AS "Done_HourBin",            hour_bin_get_bin_label((date_part('hour'::text, analytic_sterilizer_load.status_done_local_dts))::integer) AS "Done_HourBinName"           FROM (((((((analytic_sterilizer_load             LEFT JOIN sterilize_method ON ((analytic_sterilizer_load.sterilize_method_id = sterilize_method.id)))             LEFT JOIN sterilize_params ON ((analytic_sterilizer_load.sterilize_params_id = sterilize_params.id)))             LEFT JOIN sterilizer ON ((analytic_sterilizer_load.sterilizer_id = sterilizer.id)))             LEFT JOIN facility ON ((analytic_sterilizer_load.facility_id = facility.id)))             LEFT JOIN web_user ON ((analytic_sterilizer_load.web_user_id = web_user.id)))             LEFT JOIN hour_bin ON ((date_part('hour'::text, analytic_sterilizer_load.status_building_local_dts) = (hour_bin.bin_hour)::double precision)))             LEFT JOIN hsys ON ((facility.hsys_id = hsys.id)))        ) SELECT expanded_data."HsysName",    expanded_data."FacilityName",    expanded_data."UserName",    expanded_data."Status",    expanded_data."Sterilizer",    expanded_data."Method",    expanded_data."Params",    expanded_data."isIUSS",    expanded_data."NumTrays",    expanded_data."NumPacks",    expanded_data."NumInst",    expanded_data."Built_UTC",    expanded_data."BuiltDTS",    expanded_data."Built_Local",    expanded_data."Built_Date",    expanded_data."Built_DayOfWeek",    expanded_data."Built_DayName",    expanded_data."Built_HourOfDay",    expanded_data."Built_HourBin",    expanded_data."Built_HourBinName",    expanded_data."Done_UTC",    expanded_data."DoneDTS",    expanded_data."Done_Local",    expanded_data."Done_Date",    expanded_data."Done_DayOfWeek",    expanded_data."Done_DayName",    expanded_data."Done_HourOfDay",    expanded_data."Done_HourBin",    expanded_data."Done_HourBinName",    ntile(100) OVER (ORDER BY expanded_data."NumInst") AS "NumInstValuePercentile",    ntile(100) OVER (ORDER BY expanded_data."NumPacks") AS "NumPacksValuePercentile",    ntile(100) OVER (ORDER BY expanded_data."NumTrays") AS "NumTraysValuePercentile"   FROM expanded_data;ALTER VIEW api.analytic_sterilizer_load_domo    OWNER TO user_change_structure;-------------------------------------------------- Register view------------------------------------------------CALL view_register ('api','analytic_sterilizer_load_domo','[SterilizerLoad] details','PROD Analytic Sterilizer Load PG');