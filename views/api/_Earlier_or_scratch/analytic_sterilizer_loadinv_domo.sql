CREATE OR REPLACE VIEW api.analytic_sterilizer_loadinv_domo ASWITH expanded_data AS(SELECT    hsys.name_ AS "HsysName",    facility.name_ AS "FacilityName",    web_user.name_full AS "UserName",    specialty.name_ AS "Specialty",    COALESCE(item_type.name_,'') AS "ItemType",    item.name_ AS "ItemName",    analytic_sterilizer_loadinv.inv_name_provided AS "InvName",    inv.their_name AS "InvName_TheirName",    greatest(1,analytic_sterilizer_loadinv.num_inst) AS "NumInst",    sterilizer.name_ AS "Sterilizer",    sterilize_method.name_ AS "Method",    sterilize_params.name_ AS "Params",    analytic_sterilizer_loadinv.is_iuss AS "isIUSS",    analytic_sterilizer_loadinv.qty AS "Qty",    analytic_sterilizer_loadinv.category AS "Category",    analytic_sterilizer_loadinv.clinic_dept_name AS "ClinicDeptName",    analytic_sterilizer_loadinv.done_dts AS "DoneDTS",    analytic_sterilizer_loadinv.done_local_dts AS "Done_Local",	DATE(analytic_sterilizer_loadinv.done_local_dts) AS "Done_Date",    date_part('dow', analytic_sterilizer_loadinv.done_local_dts)::integer AS "Done_DayOfWeek",    to_char((analytic_sterilizer_loadinv.done_local_dts), 'Day') AS "Done_DayName",    date_part('hour', analytic_sterilizer_loadinv.done_local_dts)::integer AS "Done_HourOfDay",    hour_bin_get_bin(date_part('hour', analytic_sterilizer_loadinv.done_local_dts)::INTEGER) AS "Done_HourBin",    hour_bin_get_bin_label(date_part('hour', analytic_sterilizer_loadinv.done_local_dts)::INTEGER) AS "Done_HourBinName",    analytic_sterilizer_loadinv.processing_seconds AS "Processing_Seconds"    FROM analytic_sterilizer_loadinv	LEFT JOIN sterilize_method ON (analytic_sterilizer_loadinv.sterilize_method_id = sterilize_method.id)	LEFT JOIN sterilize_params ON (analytic_sterilizer_loadinv.sterilize_params_id = sterilize_params.id)	LEFT JOIN sterilizer 	   ON (analytic_sterilizer_loadinv.sterilizer_id  	   = sterilizer.id)	LEFT JOIN facility 		   ON (analytic_sterilizer_loadinv.facility_id 		   = facility.id)	LEFT JOIN data_file_info   ON (analytic_sterilizer_loadinv.data_file_id 	   = data_file_info.id)	LEFT JOIN web_user 	   	   ON (analytic_sterilizer_loadinv.web_user_id		   = web_user.id)	LEFT JOIN hsys			   ON (analytic_sterilizer_loadinv.hsys_id 			   = hsys.id)	LEFT JOIN inv	 	   	   ON (analytic_sterilizer_loadinv.inv_id			   = inv.id)	LEFT JOIN item	   	       ON (analytic_sterilizer_loadinv.item_id			   = item.id)	LEFT JOIN specialty 	   ON (analytic_sterilizer_loadinv.speciality_id	   = specialty.id)	LEFT JOIN item_type 	   ON (analytic_sterilizer_loadinv.item_type_id		   = item_type.id) /* We dont' always have a related item_type.*/ ) SELECT *,       ntile(100) over (order by "NumInst") AS "NumInstPercentile",       ntile(100) over (order by "Qty") AS "QtyPercentile"   FROM expanded_data;ALTER VIEW api.analytic_sterilizer_loadinv_domo    OWNER TO user_change_structure;-------------------------------------------------- Register view------------------------------------------------CALL view_register ('api','analytic_sterilizer_loadinv_domo','Analytic data derived largely from [SterilizerLoad_Inv].','PROD Analytic Load Inventory PG');