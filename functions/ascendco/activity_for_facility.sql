DROP FUNCTION IF EXISTS     ascendco.activity_for_facility (uuid);CREATE OR REPLACE FUNCTION  ascendco.activity_for_facility (in_facility_id uuid)RETURNS TABLE (    activity_id          uuid,    hsys_name            citext,    facility_id          uuid,    facility_name        citext,    activity_name        citext,    server_name          citext,    start_dts            timestamp,    done_dts             timestamp,    duration_seconds     int4,    updated_dts          timestamp,    marked_for_deletion  boolean,    other_desc           citext,    user_name            citext,    created_dts          timestamp,    created_by           citext,    updated_by           citext)LANGUAGE sql STABLEAS $BODY$SELECT activity.id                                             AS activity_id,       coalesce(hsys.name_, 'Unknown')                         AS hsys_name,       facility.id,       coalesce(facility.name_, 'Unknown')                     AS facility_name,       coalesce(facility_activities.name_, 'Unknown')          AS activity_name,       coalesce(data_file_info.server_name_, 'Unknown')        AS server_name,       activity.start_dts,       activity.done_dts,       activity.duration_seconds,       activity.updated_dts,       activity.marked_for_deletion,       activity.other_desc,       coalesce(web_user.name_full, 'Unknown')                 AS user_name,       activity.created_dts,       activity.created_by,       activity.updated_by--   Note: activity doesn't have hsys_id, you neeed to load facility, and get the hsys_id from there.     FROM activityLEFT JOIN facility_activities  ON facility_activities.id   = activity.facility_activities_idLEFT JOIN web_user             ON web_user.id              =  activity.web_user_idLEFT JOIN data_file_info       ON data_file_info.id        =  activity.last_updated_by_data_file_idLEFT JOIN facility             ON facility.id              =  activity.facility_idLEFT JOIN hsys                 ON hsys.id                  =  facility.hsys_idWHERE activity.facility_id = in_facility_id;$BODY$;COMMENT ON FUNCTION ascendco.activity_for_facility (uuid) IS'Pass in a facility_id and get back a list of activity records.';ALTER FUNCTION ascendco.activity_for_facility (uuid)	OWNER TO user_bender;