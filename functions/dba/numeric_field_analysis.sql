DROP FUNCTION IF EXISTS dba.numeric_field_analysis(text,text);-- This is going to be a bit slow as it has to grind through the data...not all of which is indexed.CREATE OR REPLACE FUNCTION dba.numeric_field_analysis (table_name_in text, field_name text)  RETURNS TABLE (	table_name text, 	column_name text, 	min int4, 	max int4, 	avg float4, 	variance float4, 	stddev float4,     stddev_1_above float4,    stddev_1_below float4,    stddev_2_above float4,    stddev_2_below float4,    stddev_3_above float4,    stddev_3_below float4,    stddev_4_above float4,    stddev_4_below float4,    stddev_5_above float4,    stddev_5_below float4,	q1 float4, 	q2 float4, 	q3 float4, 	p95 float4, 	iqr float4,		stddev_1_above_count int4,	stddev_1_above_min float4,	stddev_1_above_max float4,	stddev_1_below_count int4,	stddev_1_below_min float4,	stddev_1_below_max float4,	stddev_2_above_count int4,	stddev_2_above_min float4,	stddev_2_above_max float4,	stddev_2_below_count int4,	stddev_2_below_min float4,	stddev_2_below_max float4,	stddev_3_above_count int4,	stddev_3_above_min float4,	stddev_3_above_max float4,	stddev_3_below_count int4,	stddev_3_below_min float4,	stddev_3_below_max float4,	stddev_4_above_count int4,	stddev_4_above_min float4,	stddev_4_above_max float4,	stddev_4_below_count int4,	stddev_4_below_min float4,	stddev_4_below_max float4,	stddev_5_above_count int4,	stddev_5_above_min float4,	stddev_5_above_max float4,	stddev_5_below_count int4,	stddev_5_below_min float4,	stddev_5_below_max float4,	q3_count int4,	q3_min float4,	q3_max float4,		p95_count int4,	p95_min float4,	p95_max float4,		p99_count int4,	p99_min float4,	p99_max	float4)	AS $BODY$  BEGIN    RETURN QUERY EXECUTE        'with 	overall_stats as 	(select *	   from numeric_field_stats(' || quote_literal(table_name_in) || ',' || quote_literal(field_name) || ')	 ), 	q3_stats as 	(select count(*)::int4 as q3_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as q3_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as q3_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select q3 from overall_stats)),  	stddev_stats as 	(select count(*)::int4 as stddev_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select stddev from overall_stats)),  	stddev_1_above_stats as 	(select count(*)::int4 as stddev_1_above_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_1_above_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_1_above_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select stddev_1_above from overall_stats)), 	stddev_1_below_stats as 	(select count(*)::int4 as stddev_1_below_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_1_below_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_1_below_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' <= (select stddev_1_below from overall_stats)), 	stddev_2_above_stats as 	(select count(*)::int4 as stddev_2_above_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_2_above_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_2_above_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select stddev_2_above from overall_stats)), 	stddev_2_below_stats as 	(select count(*)::int4 as stddev_2_below_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_2_below_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_2_below_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || '<= (select stddev_2_below from overall_stats)), 	stddev_3_above_stats as 	(select count(*)::int4 as stddev_3_above_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_3_above_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_3_above_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select stddev_3_above from overall_stats)), 	stddev_3_below_stats as 	(select count(*)::int4 as stddev_3_below_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_3_below_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_3_below_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' <= (select stddev_3_below from overall_stats)), 	stddev_4_above_stats as 	(select count(*)::int4 as stddev_4_above_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_4_above_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_4_above_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select stddev_4_above from overall_stats)), 	stddev_4_below_stats as 	(select count(*)::int4 as stddev_4_below_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_4_below_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_4_below_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' <= (select stddev_4_below from overall_stats)), 	stddev_5_above_stats as 	(select count(*)::int4 as stddev_5_above_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_5_above_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_5_above_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select stddev_5_above from overall_stats)), 	stddev_5_below_stats as 	(select count(*)::int4 as stddev_5_below_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as stddev_5_below_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as stddev_5_below_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' <= (select stddev_5_below from overall_stats)),	  	p95_stats as 	(select count(*)::int4 as p95_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as p95_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as p95_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select p95 from overall_stats)),	p99_stats as 	(select count(*)::int4 as p99_count,             coalesce(min(' || quote_ident(field_name) || '),0)::float4 as p99_min,             coalesce(max(' || quote_ident(field_name) || '),0)::float4 as p99_max		  	   from '|| quote_ident(table_name_in) || '	  where ' || quote_ident(field_name) || ' >= (select p99 from overall_stats))   	select overall_stats.table_name,           overall_stats.column_name,           overall_stats.min,           overall_stats.max,           overall_stats.avg,           overall_stats.variance,           overall_stats.stddev,           stddev_1_above,           stddev_1_below,           stddev_2_above,           stddev_2_below,           stddev_3_above,           stddev_3_below,           stddev_4_above,           stddev_4_below,           stddev_4_above,           stddev_5_below,                      overall_stats.q1,           overall_stats.q2,           overall_stats.q3,           overall_stats.p95,           overall_stats.iqr,           stddev_1_above_stats.stddev_1_above_count,           stddev_1_above_stats.stddev_1_above_min,           stddev_1_above_stats.stddev_1_above_max,           stddev_1_below_stats.stddev_1_below_count,           stddev_1_below_stats.stddev_1_below_min,           stddev_1_below_stats.stddev_1_below_max,           stddev_2_above_stats.stddev_2_above_count,           stddev_2_above_stats.stddev_2_above_min,           stddev_2_above_stats.stddev_2_above_max,           stddev_2_below_stats.stddev_2_below_count,           stddev_2_below_stats.stddev_2_below_min,           stddev_2_below_stats.stddev_2_below_max,           stddev_3_above_stats.stddev_3_above_count,           stddev_3_above_stats.stddev_3_above_min,           stddev_3_above_stats.stddev_3_above_max,           stddev_3_below_stats.stddev_3_below_count,           stddev_3_below_stats.stddev_3_below_min,           stddev_3_below_stats.stddev_3_below_max,           stddev_4_above_stats.stddev_4_above_count,           stddev_4_above_stats.stddev_4_above_min,           stddev_4_above_stats.stddev_4_above_max,           stddev_4_below_stats.stddev_4_below_count,           stddev_4_below_stats.stddev_4_below_min,           stddev_4_below_stats.stddev_4_below_max,           stddev_5_above_stats.stddev_5_above_count,           stddev_5_above_stats.stddev_5_above_min,           stddev_5_above_stats.stddev_5_above_max,           stddev_5_below_stats.stddev_5_below_count,           stddev_5_below_stats.stddev_5_below_min,           stddev_5_below_stats.stddev_5_below_max,                      q3_stats.q3_count,           q3_stats.q3_min,           q3_stats.q3_max,                      p95_stats.p95_count,           p95_stats.p95_min,           p95_stats.p95_max,                      p99_stats.p99_count,           p99_stats.p99_min,           p99_stats.p99_max      from overall_stats,           stddev_1_above_stats,           stddev_1_below_stats,           stddev_2_above_stats,           stddev_2_below_stats,           stddev_3_above_stats,           stddev_3_below_stats,           stddev_4_above_stats,           stddev_4_below_stats,           stddev_5_above_stats,           stddev_5_below_stats,           q3_stats,           p95_stats,           p99_stats'                                           USING table_name_in, field_name;	END;$BODY$  LANGUAGE plpgsql;ALTER FUNCTION dba.numeric_field_analysis (text, text) 	OWNER TO user_bender;