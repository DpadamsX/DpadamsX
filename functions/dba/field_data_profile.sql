CREATE OR REPLACE FUNCTION dba.field_data_profile (table_name text, field_name text)  RETURNS TABLE (  	distinct_value extensions.citext,   	page_correlation float4,   	field_cardinality int8,   	rows_count int8,   	value_frequency int8,   	selectivity numeric,   	proportion_chart text)   	AS $BODY$BEGINRETURN QUERY EXECUTE 'with table_estimate as (select correlation  from pg_stats   where tablename = ''' || table_name || ''' and         attname   = ''' || field_name || '''),          distinct_values as  (select distinct ' || quote_ident(field_name) || '::citext as distinct_value,         count(*) as frequency     from ' || quote_ident(table_name) || ' group by ' || quote_ident(field_name) || '),  row_figures as  (select count(*) as rows_count     from ' || quote_ident(table_name) || ') select  distinct_values.distinct_value,        table_estimate.correlation as page_correlation,        (select count(*) as field_cardinality from distinct_values),		 row_figures.rows_count,		 distinct_values.frequency as value_frequency,          round((distinct_values.frequency::decimal / row_figures.rows_count::decimal),3) as value_selectivity,        repeat(' || quote_literal('â–€') || ', ((distinct_values.frequency::decimal / row_figures.rows_count::decimal)*100)::int) as proportion_chart           from distinct_values,        table_estimate,        row_figures        '    	using  table_name, field_name;END;$BODY$  LANGUAGE plpgsql VOLATILE  COST 100  ROWS 1000;  ALTER FUNCTION dba.field_data_profile(text, text)	OWNER TO user_bender;  