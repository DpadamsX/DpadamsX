/* The Domo SELECT for this is:SELECT * from trays_per_hour_pg_v1;If you have mutiple version for this DataSet in the domo_passthrough table at once,then the Domo SELECT needs to use UNION to combine the results.*/-- View: passthrough.trays_per_hour_pg_v1DROP VIEW IF EXISTS passthrough.trays_per_hour_pg_v1;CREATE OR REPLACE VIEW passthrough.trays_per_hour_pg_v1 AS     SELECT            coalesce(hsys.name_,'') as "HsysName",            coalesce(facility.name_,'') as "FacilityName",            expanded_data."Assemble_Date" AS "Assemble_Date",            expanded_data."Assemble_DayName" AS "Assemble_DayName",            expanded_data."Assemble_DayOfWeek" AS "Assemble_DayOfWeek",            expanded_data."FacilityID" AS "FacilityID",            expanded_data."HoursAssembly" AS "HoursAssembly",            expanded_data."HsysID" AS "HsysID",            expanded_data."InstAssembled" AS "InstAssembled",            expanded_data."InstPerHour" AS "InstPerHour",            expanded_data."TraysAssembled" AS "TraysAssembled",            expanded_data."TraysPerHour" AS "TraysPerHour",            coalesce(web_user.name_full,domo_passthrough.data -> 0 ->> 'UserName') AS "UserName" -- Lookup or, if that fails, label from packed data.       FROM domo_passthrough  LEFT JOIN facility on (domo_passthrough.facility_id = facility.id)  LEFT JOIN hsys     on (domo_passthrough.hsys_id = hsys.id)  LEFT JOIN web_user on ((domo_passthrough.data -> 0 ->> 'UserID')::uuid = web_user.id)CROSS JOIN jsonb_to_recordset(domo_passthrough.data) as expanded_data (            "Assemble_Date" date,            "Assemble_DayName" citext,            "Assemble_DayOfWeek" float8,            "FacilityID" uuid,            "HoursAssembly" float8,            "HsysID" uuid,            "InstAssembled" float8,            "InstPerHour" float8,            "TraysAssembled" float8,            "TraysPerHour" float8,            "UserID" uuid,            "UserName" citext)    WHERE dataset_name = 'TraysPerHour_PG' AND          view_version = 1; -- Important! The view knows how to parse out JSONB data packed in this way.ALTER TABLE passthrough.trays_per_hour_pg_v1    OWNER TO user_change_structure;----------------------------------------------- Register view---------------------------------------------CALL view_register ('passthrough','trays_per_hour_pg_v1','','TraysPerHour_PG');