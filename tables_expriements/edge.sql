-------------------------------------- Define table------------------------------------BEGIN;DROP TABLE IF EXISTS ascendco.edge CASCADE;CREATE TABLE IF NOT EXISTS ascendco.edge (    id                           uuid        NOT NULL DEFAULT NULL,    inv_id                       uuid        NOT NULL DEFAULT NULL,    from_scan_at_facility_id     uuid        NOT NULL DEFAULT NULL,    from_associated_to_id        uuid        NOT NULL DEFAULT NULL,    to_associated_to_id          uuid        NOT NULL DEFAULT NULL,    from_web_user_id             uuid        NOT NULL DEFAULT NULL,    from_assembly_id             uuid        NOT NULL DEFAULT NULL,    from_scan_id                 uuid        NOT NULL DEFAULT NULL,    from_sterilizer_load_id      uuid        NOT NULL DEFAULT NULL,    from_facility_location_id    uuid        NOT NULL DEFAULT NULL,    from_facility_id             uuid        NOT NULL DEFAULT NULL,    from_washer_load_id          uuid        NOT NULL DEFAULT NULL,    from_scase_id                uuid        NOT NULL DEFAULT NULL,    from_clinic_id               uuid        NOT NULL DEFAULT NULL,    from_facility_department_id  uuid        NOT NULL DEFAULT NULL,    hsys_id                      uuid        NOT NULL DEFAULT NULL,    to_scan_id                   uuid        NOT NULL DEFAULT NULL,    to_scan_at_facility_id       uuid        NOT NULL DEFAULT NULL,    to_web_user_id               uuid        NOT NULL DEFAULT NULL,    to_facility_location_id      uuid        NOT NULL DEFAULT NULL,    to_sterilizer_load_id        uuid        NOT NULL DEFAULT NULL,    to_washer_load_id            uuid        NOT NULL DEFAULT NULL,    to_facility_id               uuid        NOT NULL DEFAULT NULL,    to_scase_id                  uuid        NOT NULL DEFAULT NULL,    to_clinic_id                 uuid        NOT NULL DEFAULT NULL,    to_facility_department_id    uuid        NOT NULL DEFAULT NULL,    to_assembly_id               uuid        NOT NULL DEFAULT NULL,    sequence_id                  uuid        NOT NULL DEFAULT NULL,    num_inst                     integer     NOT NULL DEFAULT 0,    seconds                      integer     NOT NULL DEFAULT 0,    from_node_dts                timestamp   NOT NULL DEFAULT NULL,    to_node_dts                  timestamp   NOT NULL DEFAULT NULL,    created_dts                  timestamp   NOT NULL DEFAULT NULL,    updated_dts                  timestamp   NOT NULL DEFAULT NULL,    from_to_range                tsrange     GENERATED ALWAYS AS (tsrange(from_node_dts, to_node_dts)) STORED,    from_node                    citext      NOT NULL DEFAULT NULL,    to_node                      citext      NOT NULL DEFAULT NULL,    from_to_node                 citext      NOT NULL DEFAULT NULL,    from_associated_to           citext      NOT NULL DEFAULT NULL,    to_associated_to             citext      NOT NULL DEFAULT NULL,    from_user_name               citext      NOT NULL DEFAULT NULL,    source_                      citext      NOT NULL DEFAULT NULL,    is_fake                      citext      NOT NULL DEFAULT NULL,    to_user_name                 citext      NOT NULL DEFAULT NULL,CONSTRAINT edge_id_pkey    PRIMARY KEY (id),CONSTRAINT starts_before_finishes    CHECK (from_node_dts <= to_node_dts) -- Make sure that we don't end up with *any* records with a start time later than the end time. = is fine.);ALTER TABLE ascendco.edge    OWNER TO user_change_structure;COMMIT;-------------------------------------- Manual Permissions for now------------------------------------GRANT SELECT, INSERT, UPDATE, DELETE ON edge TO rds_super;GRANT SELECT ON edge TO user_reporting;GRANT SELECT, INSERT, UPDATE ON edge TO user_iceberg;GRANT SELECT, INSERT, UPDATE ON edge TO user_iceberg_remote;GRANT SELECT, INSERT, UPDATE ON edge TO user_saws;GRANT SELECT, INSERT, UPDATE ON edge TO user_sonar;GRANT SELECT, INSERT, UPDATE ON edge TO user_leviathan;GRANT SELECT, INSERT, UPDATE ON edge TO user_change_structure;-------------------------------------- Build indexes------------------------------------CREATE INDEX edge_sequence_id_ix_btree    ON ascendco.edge    USING btree (sequence_id);CREATE INDEX edge_from_to_range_ix_gist    ON ascendco.edge  USING GIST (from_to_range);-------------------------------------- Add triggers------------------------------------CREATE TRIGGER trigger_edge_after_delete    AFTER DELETE    ON ascendco.edge    REFERENCING OLD TABLE AS deleted_rows    FOR EACH STATEMENT    EXECUTE PROCEDURE ascendco.trigger_function_log_deletion_count();CREATE TRIGGER trigger_edge_before_truncate    BEFORE TRUNCATE ON ascendco.edge    FOR EACH STATEMENT    EXECUTE PROCEDURE ascendco.trigger_function_log_truncation_count();